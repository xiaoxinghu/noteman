#!/usr/bin/env ruby

require 'gli'
require 'noteman'

include GLI::App

program_desc 'A CLI note manager.'

desc 'Do the action to all resulting notes.'
switch [:a, :all]

command :test do |c|
  c.action do |global_options,options,args|
		words = ['Hello', 'test', 'as']
		content = "this is as teSt, hello world."
		if words.all? { |word| content.downcase.include? word.downcase }
			puts 'yes'
		else
			puts 'no'
		end
  end
end

desc 'Search for notes.'
arg_name 'tags'
command :find do |c|
	desc 'Search by fomula.'
	c.flag [:f, :fomula]

	desc 'Search by tags.'
	c.flag [:t, :tags]

	desc 'Search by keywords.'
	c.flag [:k, :keywords]

  c.action do |global_options,options,args|
		nm = Noteman::NoteManager.new
		nm.search
		if options[:fomula]
			nm.search_by_fomular options[:fomula].result
		else
			if options[:tags]
				nm.by_tags(options[:tags].split(','))
			end
			if options[:keywords]
				nm.by_keywords(options[:keywords].split)
			end
		end
		nm.view_result
  end
end

desc 'capture new note'
arg_name 'note'
command :new do |c|
  c.action do |global_options,options,args|
    man = Noteman::CaptureMan.new
    if args.length > 0
      man.capture args.join ' '
    else
      input = man.fork_editor
      man.capture input
    end
  end
end

exit run(ARGV)
